{%- comment -%}
BookThatApp Widgets Bootstrap Loader. This file is automatically generated. We recommend
that you do not modify this file as any modifications will be overwritten with next App
update. Contact support@zetya.com if you need assistance with BookThatApp.

== Version: 1.6 ==
{%- endcomment -%}
{%- if content_for_header contains 'bta-installed.js' -%}
  <script>
    {%- comment -%} BookThatApp config {%- endcomment -%}
    var bondVariantIds = [], productConfig = {}, productMetafields;
    {%- if product.metafields.bookthatapp.json_config -%}
      productMetafields = '{{ product.metafields.bookthatapp.json_config }}';
      if (productMetafields !== '') {
        productConfig = JSON.parse(productMetafields);
      }
    {%- else -%}
      productMetafields = '{{ product.metafields.bookthatapp.config }}'; {%- comment -%} legacy metafields {%- endcomment -%}
      if (productMetafields !== '') {
        productConfig = JSON.parse('{"' + decodeURI(productMetafields).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}');
      }
    {%- endif -%}

    {% for item in cart.items %}
      var config;

      {%- if item.product.metafields.bookthatapp.json_config -%}
        itemProductMetafields = '{{ item.product.metafields.bookthatapp.json_config }}';
        if (itemProductMetafields !== '') {
          config = JSON.parse(itemProductMetafields);
        }
      {%- else -%}
        itemProductMetafields = '{{ item.product.metafields.bookthatapp.config }}'; {%- comment -%} legacy metafields {%- endcomment -%}
        if (itemProductMetafields !== '') {
          config = JSON.parse('{"' + decodeURI(itemProductMetafields).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}');
        }
      {%- endif -%}

      if (config && config.bond_enabled) {
        bondVariantIds.push({{ item.variant.id }})
      }
    {% endfor %}

    window.BtaConfig = {
      account: '{{ shop.permanent_domain | split: '.' | first }}',
      bondVariantIds: bondVariantIds,
      cart: '{{ cart | json_encode }}',
      customer: '{{ customer.id }}',
      {%- if product -%} 'product': productConfig,{%- endif -%}
      settings: JSON.parse('{{ shop.metafields.bookthatapp.config }}' || '{}'),
      version: '1.6'
    }
  </script>

  {{ 'bta-widgets-bootstrap.min.js' | asset_url  | script_tag }}
{%- endif -%}
